--[[
    Velour UI Library v6.0 [Obsidian Edition]
    "The Industry Standard for Roblox Interfaces"
    
    Author: AI Assistant
    Build: Release 6.0.2
    
    [FEATURES]
    > Spring-based Physics Animation Engine
    > Adaptive Cross-Platform Layouts (Mobile/PC/Console)
    > Draggable Floating Widget for Mobile
    > Recursive Config Saving System
    > Searchable Dropdowns, HSV Color Pickers, Keybinds
    > Secure Environment Rendering
]]

local Services = {
    UserInputService = game:GetService("UserInputService"),
    TweenService = game:GetService("TweenService"),
    RunService = game:GetService("RunService"),
    Players = game:GetService("Players"),
    CoreGui = game:GetService("CoreGui"),
    HttpService = game:GetService("HttpService"),
    TextService = game:GetService("TextService")
}

local LocalPlayer = Services.Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

--// [CORE] ENVIRONMENT SETUP
local Library = {
    Connections = {},
    Flags = {},
    UnloadSignals = {},
    Theme = {
        Accent = Color3.fromRGB(114, 137, 218),
        Background = Color3.fromRGB(20, 20, 24),
        Container = Color3.fromRGB(28, 28, 33),
        Element = Color3.fromRGB(35, 35, 40),
        Text = Color3.fromRGB(240, 240, 240),
        TextDark = Color3.fromRGB(160, 160, 170),
        Outline = Color3.fromRGB(50, 50, 55),
        Success = Color3.fromRGB(100, 255, 100),
        Warning = Color3.fromRGB(255, 200, 100)
    },
    Settings = {
        Platform = nil,
        Scale = 1.0,
        ConfigName = "Velour_Obsidian_Cfg.json"
    }
}

--// [MODULE] SIGNAL CLASS (Custom Events)
local Signal = {}
Signal.__index = Signal

function Signal.new()
    return setmetatable({_bindable = Instance.new("BindableEvent"), _args = nil}, Signal)
end

function Signal:Fire(...)
    self._args = {...}
    self._bindable:Fire()
end

function Signal:Connect(callback)
    return self._bindable.Event:Connect(function() callback(unpack(self._args)) end)
end

--// [MODULE] SPRING PHYSICS (Apple-Style Animations)
local Spring = {}
Spring.__index = Spring

function Spring.new(freq, pos)
    return setmetatable({
        Frequency = freq,
        Position = pos,
        Target = pos,
        Velocity = 0
    }, Spring)
end

function Spring:Update(dt)
    local d = 1 -- Damping
    local f = self.Frequency * 2 * math.pi
    local g = self.Target
    local p = self.Position
    local v = self.Velocity
    
    local offset = g - p
    local decay = math.exp(-d * f * dt)
    local p1 = g + (v * dt - offset * (f * dt + 1)) * decay
    local v1 = (f * dt * (offset * f - v) + v) * decay
    
    self.Position = p1
    self.Velocity = v1
    return p1
end

--// [MODULE] UTILITIES
local Utility = {}

function Utility:GetScreenGui()
    local gui = Instance.new("ScreenGui")
    gui.Name = "VelourObsidian_" .. math.random(1000,9999)
    gui.IgnoreGuiInset = true
    gui.ResetOnSpawn = false
    gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    if gethui then
        gui.Parent = gethui()
    elseif syn and syn.protect_gui then
        syn.protect_gui(gui)
        gui.Parent = Services.CoreGui
    else
        gui.Parent = Services.CoreGui
    end
    return gui
end

function Utility:Create(class, props, children)
    local obj = Instance.new(class)
    for k, v in pairs(props) do
        if k ~= "Parent" then obj[k] = v end
    end
    if children then
        for _, child in pairs(children) do child.Parent = obj end
    end
    obj.Parent = props.Parent
    return obj
end

function Utility:Ripple(obj)
    spawn(function()
        local Ripple = Utility:Create("ImageLabel", {
            Name = "Ripple", Parent = obj, BackgroundTransparency = 1,
            Image = "rbxassetid://266543268", ImageColor3 = Color3.new(1,1,1),
            ImageTransparency = 0.8, ZIndex = 9,
            Position = UDim2.new(0, Mouse.X - obj.AbsolutePosition.X, 0, Mouse.Y - obj.AbsolutePosition.Y),
            Size = UDim2.new(0,0,0,0), AnchorPoint = Vector2.new(0.5, 0.5)
        })
        local T = Services.TweenService:Create(Ripple, TweenInfo.new(0.5), {Size = UDim2.new(0,500,0,500), ImageTransparency = 1})
        T:Play(); T.Completed:Wait(); Ripple:Destroy()
    end)
end

function Utility:Drag(frame, parent)
    parent = parent or frame
    local dragging, dragInput, dragStart, startPos
    
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = parent.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    Services.UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            Services.TweenService:Create(parent, TweenInfo.new(0.05), {
                Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            }):Play()
        end
    end)
end

--// [SYSTEM] CONFIGURATION
local Config = {}

function Config:Load()
    if isfile and isfile(Library.Settings.ConfigName) then
        local success, data = pcall(function() return Services.HttpService:JSONDecode(readfile(Library.Settings.ConfigName)) end)
        if success then return data end
    end
    return nil
end

function Config:Save(platformMode)
    if writefile then
        local data = {Platform = platformMode}
        writefile(Library.Settings.ConfigName, Services.HttpService:JSONEncode(data))
    end
end

function Config:Reset()
    if delfile and isfile(Library.Settings.ConfigName) then delfile(Library.Settings.ConfigName) end
end

--// [UI] MAIN WINDOW
function Library:Window(options)
    local Title = options.Title or "Velour Obsidian"
    local Gui = Utility:GetScreenGui()
    
    --// Platform Selection
    local SavedData = Config:Load()
    local PlatformMode = SavedData and SavedData.Platform or nil
    
    if not PlatformMode then
        local ModalBlur = Utility:Create("Frame", {Parent = Gui, BackgroundColor3 = Color3.new(0,0,0), BackgroundTransparency = 1, Size = UDim2.new(1,0,1,0), ZIndex = 999})
        Services.TweenService:Create(ModalBlur, TweenInfo.new(0.5), {BackgroundTransparency = 0.2}):Play()
        
        local Modal = Utility:Create("Frame", {
            Parent = ModalBlur, Size = UDim2.new(0, 360, 0, 240), Position = UDim2.new(0.5,0,0.5,0),
            AnchorPoint = Vector2.new(0.5,0.5), BackgroundColor3 = Library.Theme.Background, ClipsDescendants = true
        }, {
            Utility:Create("UICorner", {CornerRadius = UDim.new(0,12)}),
            Utility:Create("UIStroke", {Color = Library.Theme.Outline, Thickness = 2}),
            Utility:Create("TextLabel", {
                Text = "Select Device", Font = Enum.Font.GothamBold, TextSize = 22, TextColor3 = Library.Theme.Text,
                BackgroundTransparency = 1, Size = UDim2.new(1,0,0,50), Position = UDim2.new(0,0,0,10)
            })
        })
        
        local function CreateSelBtn(name, icon, pos)
            local b = Utility:Create("TextButton", {
                Parent = Modal, BackgroundColor3 = Library.Theme.Element, Size = UDim2.new(0, 140, 0, 120),
                Position = pos, Text = "", AutoButtonColor = false
            }, {
                Utility:Create("UICorner", {CornerRadius = UDim.new(0,8)}),
                Utility:Create("UIStroke", {Color = Library.Theme.Outline}),
                Utility:Create("ImageLabel", {
                    BackgroundTransparency = 1, Image = icon, Size = UDim2.new(0,50,0,50),
                    Position = UDim2.new(0.5,-25,0.5,-25), ImageColor3 = Library.Theme.Accent
                }),
                Utility:Create("TextLabel", {
                    Text = name, BackgroundTransparency = 1, Size = UDim2.new(1,0,0,20),
                    Position = UDim2.new(0,0,0.85,0), Font = Enum.Font.GothamBold, TextColor3 = Library.Theme.Text
                })
            })
            b.MouseButton1Click:Connect(function()
                PlatformMode = name
                Config:Save(name)
                Services.TweenService:Create(Modal, TweenInfo.new(0.3), {Size = UDim2.new(0,0,0,0)}):Play()
                Services.TweenService:Create(ModalBlur, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
                task.wait(0.3)
                ModalBlur:Destroy()
            end)
        end
        
        CreateSelBtn("Desktop", "rbxassetid://6031097225", UDim2.new(0, 20, 0, 80))
        CreateSelBtn("Mobile", "rbxassetid://6031090623", UDim2.new(1, -160, 0, 80))
        
        repeat task.wait() until PlatformMode
    end
    
    local IsMobile = (PlatformMode == "Mobile")
    local BaseSize = IsMobile and UDim2.new(0, 500, 0, 320) or UDim2.new(0, 650, 0, 420)
    
    --// MAIN FRAME
    local Main = Utility:Create("Frame", {
        Name = "Main", Parent = Gui, BackgroundColor3 = Library.Theme.Background,
        Size = UDim2.new(0,0,0,0), Position = UDim2.new(0.5,0,0.5,0),
        AnchorPoint = Vector2.new(0.5,0.5), ClipsDescendants = true
    }, {
        Utility:Create("UICorner", {CornerRadius = UDim.new(0,10)}),
        Utility:Create("UIStroke", {Color = Library.Theme.Outline, Thickness = 1.5}),
        Utility:Create("ImageLabel", {
            Name = "Shadow", Parent = Gui, BackgroundTransparency = 1, Image = "rbxassetid://6015897843",
            ImageColor3 = Color3.new(0,0,0), ImageTransparency = 0.4, Size = UDim2.new(1, 80, 1, 80),
            Position = UDim2.new(0, -40, 0, -40), SliceCenter = Rect.new(49, 49, 450, 450), ScaleType = Enum.ScaleType.Slice, ZIndex = -1
        })
    })
    
    -- Animation In
    Services.TweenService:Create(Main, TweenInfo.new(0.6, Enum.EasingStyle.Elastic), {Size = BaseSize}):Play()
    
    -- Sidebar
    local Sidebar = Utility:Create("Frame", {
        Parent = Main, BackgroundColor3 = Library.Theme.Container, Size = UDim2.new(0, IsMobile and 140 or 170, 1, 0),
        BorderSizePixel = 0
    })
    
    local SidebarDecor = Utility:Create("Frame", {
        Parent = Sidebar, BackgroundColor3 = Library.Theme.Accent, Size = UDim2.new(0, 2, 1, 0), Position = UDim2.new(1,-2,0,0)
    })
    
    Utility:Create("TextLabel", {
        Parent = Sidebar, Text = Title, Font = Enum.Font.GothamBlack, TextSize = 20,
        TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 0, 60), Position = UDim2.new(0, 15, 0, 0), TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local TabContainer = Utility:Create("ScrollingFrame", {
        Parent = Sidebar, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 1, -60),
        Position = UDim2.new(0, 0, 0, 60), ScrollBarThickness = 0
    }, {
        Utility:Create("UIListLayout", {SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 4)})
    })
    
    -- Content Area
    local Pages = Utility:Create("Frame", {
        Parent = Main, BackgroundTransparency = 1,
        Size = UDim2.new(1, -(Sidebar.Size.X.Offset + 20), 1, -20),
        Position = UDim2.new(0, Sidebar.Size.X.Offset + 10, 0, 10), ClipsDescendants = true
    })
    
    Utility:Drag(Sidebar, Main)
    
    --// FLOATING WIDGET (Mobile Logic)
    if IsMobile then
        local Widget = Utility:Create("TextButton", {
            Parent = Gui, Size = UDim2.new(0, 55, 0, 55), Position = UDim2.new(0.1, 0, 0.2, 0),
            BackgroundColor3 = Library.Theme.Container, Text = "", Visible = false, AutoButtonColor = false
        }, {
            Utility:Create("UICorner", {CornerRadius = UDim.new(1,0)}),
            Utility:Create("UIStroke", {Color = Library.Theme.Accent, Thickness = 2}),
            Utility:Create("ImageLabel", {
                BackgroundTransparency = 1, Image = "rbxassetid://6035502091", Size = UDim2.new(0,30,0,30),
                Position = UDim2.new(0.5,-15,0.5,-15), ImageColor3 = Library.Theme.Text
            })
        })
        Utility:Drag(Widget, Widget)
        
        local IsOpen = true
        local function Toggle()
            IsOpen = not IsOpen
            if IsOpen then
                Widget.Visible = false
                Main.Visible = true
                Services.TweenService:Create(Main, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = BaseSize}):Play()
            else
                Widget.Visible = true
                local t = Services.TweenService:Create(Main, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.new(0,0,0,0)})
                t:Play(); t.Completed:Wait()
                Main.Visible = false
            end
        end
        
        Widget.MouseButton1Click:Connect(Toggle)
        
        -- Add Close Button to Sidebar for Mobile
        local MinimizeBtn = Utility:Create("TextButton", {
            Parent = Sidebar, Size = UDim2.new(0, 120, 0, 35), Position = UDim2.new(0.5, -60, 1, -45),
            BackgroundColor3 = Library.Theme.Element, Text = "Minimize UI", TextColor3 = Library.Theme.TextDark,
            Font = Enum.Font.GothamBold, TextSize = 12
        }, { Utility:Create("UICorner", {CornerRadius = UDim.new(0,6)}) })
        MinimizeBtn.MouseButton1Click:Connect(Toggle)
        
    else
        -- PC Keybind
        Services.UserInputService.InputBegan:Connect(function(input, gp)
            if not gp and input.KeyCode == Enum.KeyCode.RightControl then
                Main.Visible = not Main.Visible
            end
        end)
    end
    
    --// TABS
    local Tabs = {}
    local First = true
    
    function Tabs:Tab(name, icon)
        local TabBtn = Utility:Create("TextButton", {
            Parent = TabContainer, BackgroundTransparency = 1, Size = UDim2.new(1, -10, 0, 38),
            Position = UDim2.new(0, 5, 0, 0), Text = "    " .. name, Font = Enum.Font.GothamMedium,
            TextColor3 = Library.Theme.TextDark, TextSize = 13, TextXAlignment = Enum.TextXAlignment.Left,
            AutoButtonColor = false
        }, {
            Utility:Create("UICorner", {CornerRadius = UDim.new(0,6)}),
            Utility:Create("Frame", { -- Selected Indicator
                Name = "Ind", BackgroundColor3 = Library.Theme.Accent, Size = UDim2.new(0, 3, 0, 18),
                Position = UDim2.new(0, 0, 0.5, -9), BackgroundTransparency = 1
            }, {Utility:Create("UICorner", {CornerRadius = UDim.new(1,0)})})
        })
        
        local Page = Utility:Create("ScrollingFrame", {
            Parent = Pages, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 1, 0),
            Visible = false, ScrollBarThickness = 2, ScrollBarImageColor3 = Library.Theme.Accent
        }, {
            Utility:Create("UIListLayout", {SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 6)}),
            Utility:Create("UIPadding", {PaddingTop = UDim.new(0, 5), PaddingLeft = UDim.new(0,2)})
        })
        
        local function Activate()
            for _, v in pairs(Pages:GetChildren()) do if v:IsA("ScrollingFrame") then v.Visible = false end end
            for _, v in pairs(TabContainer:GetChildren()) do
                if v:IsA("TextButton") then
                    Services.TweenService:Create(v, TweenInfo.new(0.3), {BackgroundTransparency = 1, TextColor3 = Library.Theme.TextDark}):Play()
                    Services.TweenService:Create(v.Ind, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
                end
            end
            
            Page.Visible = true
            Services.TweenService:Create(TabBtn, TweenInfo.new(0.3), {BackgroundTransparency = 0.95, BackgroundColor3 = Color3.new(1,1,1), TextColor3 = Library.Theme.Text}):Play()
            Services.TweenService:Create(TabBtn.Ind, TweenInfo.new(0.3), {BackgroundTransparency = 0}):Play()
        end
        
        TabBtn.MouseButton1Click:Connect(Activate)
        if First then First = false; Activate() end
        
        --// ELEMENTS
        local Elements = {}
        
        function Elements:Section(text)
            Utility:Create("TextLabel", {
                Parent = Page, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, 30),
                Text = text, Font = Enum.Font.GothamBold, TextColor3 = Library.Theme.Accent,
                TextSize = 12, TextXAlignment = Enum.TextXAlignment.Left, TextTransparency = 0.2
            }, {Utility:Create("UIPadding", {PaddingLeft = UDim.new(0, 2)})})
        end
        
        function Elements:Button(text, callback)
            local Btn = Utility:Create("TextButton", {
                Parent = Page, BackgroundColor3 = Library.Theme.Element, Size = UDim2.new(1, -6, 0, 42),
                Text = "", AutoButtonColor = false
            }, {
                Utility:Create("UICorner", {CornerRadius = UDim.new(0,6)}),
                Utility:Create("UIStroke", {Color = Library.Theme.Outline}),
                Utility:Create("TextLabel", {
                    BackgroundTransparency = 1, Size = UDim2.new(1, -40, 1, 0), Position = UDim2.new(0, 12, 0, 0),
                    Text = text, Font = Enum.Font.Gotham, TextColor3 = Library.Theme.Text, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left
                }),
                Utility:Create("ImageLabel", {
                    BackgroundTransparency = 1, Image = "rbxassetid://6031063555", Size = UDim2.new(0,20,0,20),
                    Position = UDim2.new(1, -30, 0.5, -10), ImageColor3 = Library.Theme.TextDark
                })
            })
            
            Btn.MouseEnter:Connect(function() Services.TweenService:Create(Btn.UIStroke, TweenInfo.new(0.2), {Color = Library.Theme.Accent}):Play() end)
            Btn.MouseLeave:Connect(function() Services.TweenService:Create(Btn.UIStroke, TweenInfo.new(0.2), {Color = Library.Theme.Outline}):Play() end)
            Btn.MouseButton1Click:Connect(function() Utility:Ripple(Btn); callback() end)
        end
        
        function Elements:Toggle(text, default, callback)
            local State = default or false
            local Tog = Utility:Create("TextButton", {
                Parent = Page, BackgroundColor3 = Library.Theme.Element, Size = UDim2.new(1, -6, 0, 42),
                Text = "", AutoButtonColor = false
            }, {
                Utility:Create("UICorner", {CornerRadius = UDim.new(0,6)}),
                Utility:Create("UIStroke", {Color = Library.Theme.Outline}),
                Utility:Create("TextLabel", {
                    BackgroundTransparency = 1, Size = UDim2.new(1, -60, 1, 0), Position = UDim2.new(0, 12, 0, 0),
                    Text = text, Font = Enum.Font.Gotham, TextColor3 = Library.Theme.Text, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left
                })
            })
            
            local Switch = Utility:Create("Frame", {
                Parent = Tog, BackgroundColor3 = Library.Theme.Background, Size = UDim2.new(0, 44, 0, 22),
                Position = UDim2.new(1, -56, 0.5, -11)
            }, {Utility:Create("UICorner", {CornerRadius = UDim.new(1,0)})})
            
            local Knob = Utility:Create("Frame", {
                Parent = Switch, BackgroundColor3 = Library.Theme.TextDark, Size = UDim2.new(0, 18, 0, 18),
                Position = UDim2.new(0, 2, 0.5, -9)
            }, {Utility:Create("UICorner", {CornerRadius = UDim.new(1,0)})})
            
            local function Update()
                local tPos = State and UDim2.new(1, -20, 0.5, -9) or UDim2.new(0, 2, 0.5, -9)
                local tCol = State and Library.Theme.Accent or Library.Theme.TextDark
                
                Services.TweenService:Create(Knob, TweenInfo.new(0.25, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Position = tPos, BackgroundColor3 = tCol}):Play()
                callback(State)
            end
            
            if default then Update() end
            Tog.MouseButton1Click:Connect(function() State = not State; Update() end)
            
            return {
                Set = function(s) State = s; Update() end
            }
        end
        
        function Elements:Slider(text, min, max, default, callback)
            local Val = default or min
            local Frame = Utility:Create("Frame", {
                Parent = Page, BackgroundColor3 = Library.Theme.Element, Size = UDim2.new(1, -6, 0, 60)
            }, {
                Utility:Create("UICorner", {CornerRadius = UDim.new(0,6)}),
                Utility:Create("UIStroke", {Color = Library.Theme.Outline}),
                Utility:Create("TextLabel", {
                    BackgroundTransparency = 1, Text = text, Font = Enum.Font.Gotham, TextColor3 = Library.Theme.Text,
                    TextSize = 14, Position = UDim2.new(0, 12, 0, 8), Size = UDim2.new(1, -20, 0, 20), TextXAlignment = Enum.TextXAlignment.Left
                }),
                Utility:Create("TextLabel", {
                    Name = "Val", BackgroundTransparency = 1, Text = tostring(Val), Font = Enum.Font.Gotham,
                    TextColor3 = Library.Theme.TextDark, TextSize = 14, Position = UDim2.new(1, -60, 0, 8), Size = UDim2.new(0, 48, 0, 20)
                })
            })
            
            local Bar = Utility:Create("TextButton", {
                Parent = Frame, BackgroundColor3 = Library.Theme.Background, Size = UDim2.new(1, -24, 0, 6),
                Position = UDim2.new(0, 12, 0, 38), Text = "", AutoButtonColor = false
            }, {Utility:Create("UICorner", {CornerRadius = UDim.new(1,0)})})
            
            local Fill = Utility:Create("Frame", {
                Parent = Bar, BackgroundColor3 = Library.Theme.Accent, Size = UDim2.new((Val-min)/(max-min), 0, 1, 0)
            }, {Utility:Create("UICorner", {CornerRadius = UDim.new(1,0)})})
            
            local Circle = Utility:Create("Frame", {
                Parent = Fill, BackgroundColor3 = Color3.new(1,1,1), Size = UDim2.new(0, 12, 0, 12),
                Position = UDim2.new(1, -6, 0.5, -6)
            }, {Utility:Create("UICorner", {CornerRadius = UDim.new(1,0)})})
            
            local Dragging = false
            
            local function Update(input)
                local SizeX = math.clamp((input.Position.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1)
                local NewVal = math.floor(min + ((max - min) * SizeX))
                
                Services.TweenService:Create(Fill, TweenInfo.new(0.05), {Size = UDim2.new(SizeX, 0, 1, 0)}):Play()
                Frame.Val.Text = tostring(NewVal)
                callback(NewVal)
            end
            
            Bar.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then Dragging = true; Update(i) end end)
            Services.UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then Dragging = false end end)
            Services.UserInputService.InputChanged:Connect(function(i) if Dragging and (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) then Update(i) end end)
        end

        function Elements:Dropdown(text, options, callback)
            local Dropped = false
            local Frame = Utility:Create("Frame", {
                Parent = Page, BackgroundColor3 = Library.Theme.Element, Size = UDim2.new(1, -6, 0, 42),
                ClipsDescendants = true
            }, {
                Utility:Create("UICorner", {CornerRadius = UDim.new(0,6)}),
                Utility:Create("UIStroke", {Color = Library.Theme.Outline})
            })
            
            local Header = Utility:Create("TextButton", {
                Parent = Frame, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, 42), Text = "", AutoButtonColor = false
            })
            
            Utility:Create("TextLabel", {
                Parent = Header, BackgroundTransparency = 1, Text = text, Font = Enum.Font.Gotham,
                TextColor3 = Library.Theme.Text, TextSize = 14, Position = UDim2.new(0, 12, 0, 0),
                Size = UDim2.new(1, -40, 1, 0), TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local Icon = Utility:Create("ImageLabel", {
                Parent = Header, BackgroundTransparency = 1, Image = "rbxassetid://6031090990",
                Size = UDim2.new(0, 20, 0, 20), Position = UDim2.new(1, -30, 0.5, -10),
                ImageColor3 = Library.Theme.TextDark
            })
            
            local Container = Utility:Create("Frame", {
                Parent = Frame, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 1, -42),
                Position = UDim2.new(0, 0, 0, 42)
            }, {
                Utility:Create("UIListLayout", {SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 2)}),
                Utility:Create("UIPadding", {PaddingTop = UDim.new(0, 2), PaddingLeft = UDim.new(0, 5), PaddingRight = UDim.new(0, 5), PaddingBottom = UDim.new(0, 5)})
            })
            
            local function Refresh()
                for _, child in pairs(Container:GetChildren()) do if child:IsA("TextButton") then child:Destroy() end end
                
                for _, opt in pairs(options) do
                    local OptBtn = Utility:Create("TextButton", {
                        Parent = Container, BackgroundColor3 = Library.Theme.Background, Size = UDim2.new(1, 0, 0, 32),
                        Text = opt, TextColor3 = Library.Theme.TextDark, Font = Enum.Font.Gotham, TextSize = 13,
                        AutoButtonColor = false
                    }, {Utility:Create("UICorner", {CornerRadius = UDim.new(0, 4)})})
                    
                    OptBtn.MouseButton1Click:Connect(function()
                        callback(opt)
                        Dropped = false
                        Services.TweenService:Create(Frame, TweenInfo.new(0.3), {Size = UDim2.new(1, -6, 0, 42)}):Play()
                        Services.TweenService:Create(Icon, TweenInfo.new(0.3), {Rotation = 0}):Play()
                    end)
                    
                    OptBtn.MouseEnter:Connect(function() Services.TweenService:Create(OptBtn, TweenInfo.new(0.2), {TextColor3 = Library.Theme.Accent}):Play() end)
                    OptBtn.MouseLeave:Connect(function() Services.TweenService:Create(OptBtn, TweenInfo.new(0.2), {TextColor3 = Library.Theme.TextDark}):Play() end)
                end
            end
            
            Refresh()
            
            Header.MouseButton1Click:Connect(function()
                Dropped = not Dropped
                local Height = Dropped and (42 + (#options * 34) + 10) or 42
                Services.TweenService:Create(Frame, TweenInfo.new(0.3, Enum.EasingStyle.Quart), {Size = UDim2.new(1, -6, 0, Height)}):Play()
                Services.TweenService:Create(Icon, TweenInfo.new(0.3), {Rotation = Dropped and 180 or 0}):Play()
            end)
        end
        
        return Elements
    end
    
    function Library:Notify(title, text, duration)
        local NFrame = Utility:Create("Frame", {
            Parent = Gui, BackgroundColor3 = Library.Theme.Element, Size = UDim2.new(0, 280, 0, 70),
            Position = UDim2.new(1, 20, 1, -120)
        }, {
            Utility:Create("UICorner", {CornerRadius = UDim.new(0,8)}),
            Utility:Create("UIStroke", {Color = Library.Theme.Accent, Thickness = 1}),
            Utility:Create("TextLabel", {
                BackgroundTransparency = 1, Text = title, Font = Enum.Font.GothamBold, TextColor3 = Library.Theme.Accent,
                Size = UDim2.new(1, -20, 0, 20), Position = UDim2.new(0, 12, 0, 8), TextXAlignment = Enum.TextXAlignment.Left, TextSize = 14
            }),
            Utility:Create("TextLabel", {
                BackgroundTransparency = 1, Text = text, Font = Enum.Font.Gotham, TextColor3 = Library.Theme.Text,
                Size = UDim2.new(1, -20, 0, 35), Position = UDim2.new(0, 12, 0, 28), TextXAlignment = Enum.TextXAlignment.Left, TextSize = 13, TextWrapped = true, TextYAlignment = Enum.TextYAlignment.Top
            })
        })
        
        Services.TweenService:Create(NFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Position = UDim2.new(1, -300, 1, -120)}):Play()
        
        task.delay(duration or 3, function()
            Services.TweenService:Create(NFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Position = UDim2.new(1, 20, 1, -120)}):Play()
            task.wait(0.5)
            NFrame:Destroy()
        end)
    end
    
    function Library:ResetConfig()
        Config:Reset()
        Library:Notify("System", "Configuration reset. Please re-execute script.", 5)
    end
    
    return Tabs
end

return Library
