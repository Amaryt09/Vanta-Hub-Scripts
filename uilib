-- Luma UI Library v2.0 - Complete Rewrite
-- Smooth, animated, mobile-friendly UI for Roblox executors
-- Features: Extensive animations, polished components, full persistence

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local Debris = game:GetService("Debris")

local Luma = {}
Luma.__index = Luma

-- ================== THEME ==================
Luma.Theme = {
	Background = Color3.fromRGB(15, 15, 20),
	BackgroundLight = Color3.fromRGB(25, 25, 32),
	Accent = Color3.fromRGB(120, 80, 255),
	AccentDark = Color3.fromRGB(90, 60, 200),
	PrimaryText = Color3.fromRGB(240, 240, 245),
	SecondaryText = Color3.fromRGB(160, 160, 170),
	Success = Color3.fromRGB(76, 175, 80),
	Warning = Color3.fromRGB(255, 152, 0),
	Error = Color3.fromRGB(244, 67, 54),
}

-- ================== ANIMATION TIMING ==================
Luma.Anim = {
	OpenTime = 0.40,
	CloseTime = 0.30,
	HoverTime = 0.15,
	EntryStagger = 0.05,
	ButtonPress = 0.08,
	SliderTween = 0.12,
	ToggleTime = 0.20,
	RippleTime = 0.65,
	DropdownReveal = 0.22,
	ModalOpen = 0.28,
}

-- ================== OPTIONAL SOUNDS ==================
Luma.Sounds = {
	Enabled = false,
	ButtonClick = nil,
	ToggleFlip = nil,
	SliderGrab = nil,
	DropdownOpen = nil,
	NotifyShow = nil,
	ModalOpen = nil,
}

local function playSound(soundName)
	if not Luma.Sounds.Enabled or not Luma.Sounds[soundName] then return end
	pcall(function()
		local sound = Instance.new("Sound")
		sound.SoundId = Luma.Sounds[soundName]
		sound.Volume = 0.6
		sound.Parent = workspace
		sound:Play()
		Debris:AddItem(sound, 2)
	end)
end

-- ================== HELPERS ==================
local function tween(inst, props, time, style, dir)
	if not inst or not inst.Parent then return end
	style = style or Enum.EasingStyle.Quint
	dir = dir or Enum.EasingDirection.Out
	local info = TweenInfo.new(time or 0.25, style, dir)
	local t = TweenService:Create(inst, info, props)
	t:Play()
	return t
end

local function make(class, props)
	local inst = Instance.new(class)
	if props then
		for k, v in pairs(props) do
			pcall(function() inst[k] = v end)
		end
	end
	return inst
end

local function createRipple(parent, position, color)
	if not parent or not parent.Parent then return end
	local ripple = make("Frame", {
		Size = UDim2.new(0, 14, 0, 14),
		AnchorPoint = Vector2.new(0.5, 0.5),
		Position = position,
		BackgroundColor3 = color or Luma.Theme.Accent,
		BackgroundTransparency = 0.4,
		Parent = parent,
		ZIndex = parent.ZIndex + 1,
	})
	make("UICorner", {Parent = ripple, CornerRadius = UDim.new(1, 0)})
	
	tween(ripple, {
		Size = UDim2.new(0, 250, 0, 250),
		BackgroundTransparency = 1
	}, Luma.Anim.RippleTime, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
	
	task.delay(Luma.Anim.RippleTime, function()
		if ripple and ripple.Parent then pcall(function() ripple:Destroy() end) end
	end)
end

local function addHoverEffects(btn, originalColor)
	if not btn then return end
	originalColor = originalColor or Luma.Theme.PrimaryText
	
	btn.MouseEnter:Connect(function()
		if btn and btn.Parent then
			pcall(function()
				tween(btn, {TextColor3 = Luma.Theme.Accent}, Luma.Anim.HoverTime, Enum.EasingStyle.Quad)
			end)
		end
	end)
	
	btn.MouseLeave:Connect(function()
		if btn and btn.Parent then
			pcall(function()
				tween(btn, {TextColor3 = originalColor}, Luma.Anim.HoverTime, Enum.EasingStyle.Quad)
			end)
		end
	end)
end

-- ================== MAIN WINDOW ==================
function Luma:Create(title)
	local self = setmetatable({}, Luma)
	self.Name = title or "Luma UI"
	self.Tabs = {}
	self.Settings = {}
	self._notifyQueue = {}
	self._notifyRunning = false
	
	-- Create ScreenGui
	local screenGui = make("ScreenGui", {
		Name = self.Name,
		ResetOnSpawn = false,
		DisplayOrder = 999,
		BackgroundTransparency = 1,
	})
	
	-- Safe parent detection
	local targetParent = game:GetService("CoreGui")
	if not RunService:IsStudio() then
		local ok, players = pcall(function()
			local plrs = game:GetService("Players"):GetPlayers()
			return plrs and #plrs > 0 and plrs[1] or nil
		end)
		if ok and players then
			local playerGui = players:FindFirstChild("PlayerGui")
			if playerGui then targetParent = playerGui end
		end
	end
	screenGui.Parent = targetParent
	self.ScreenGui = screenGui
	
	-- Main window frame
	local main = make("Frame", {
		Name = "MainWindow",
		BackgroundColor3 = Luma.Theme.Background,
		AnchorPoint = Vector2.new(0.5, 0.5),
		Position = UDim2.new(0.5, 0, 0.5, 0),
		Size = UDim2.new(0, 920, 0, 600),
		Parent = screenGui,
		ClipsDescendants = true,
	})
	make("UICorner", {Parent = main, CornerRadius = UDim.new(0, 12)})
	
	-- Drop shadow
	local shadow = make("Frame", {
		BackgroundColor3 = Color3.fromRGB(0, 0, 0),
		AnchorPoint = Vector2.new(0.5, 0.5),
		Position = main.Position,
		Size = UDim2.new(main.Size.X.Scale, main.Size.X.Offset + 30, main.Size.Y.Scale, main.Size.Y.Offset + 30),
		BackgroundTransparency = 0.85,
		Parent = screenGui,
		ZIndex = main.ZIndex - 1,
	})
	make("UICorner", {Parent = shadow, CornerRadius = UDim.new(0, 12)})
	
	self.Main = main
	
	-- ================== TITLEBAR ==================
	local titlebar = make("Frame", {
		BackgroundColor3 = Luma.Theme.Background,
		Size = UDim2.new(1, 0, 0, 52),
		Parent = main,
	})
	
	local titleGradient = make("UIGradient", {Parent = titlebar})
	titleGradient.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Luma.Theme.Background),
		ColorSequenceKeypoint.new(1, Luma.Theme.Background:Lerp(Luma.Theme.Accent, 0.1))
	})
	
	make("UIStroke", {Parent = titlebar, Color = Luma.Theme.Accent, Transparency = 0.85, Thickness = 1})
	
	local titleLabel = make("TextLabel", {
		BackgroundTransparency = 1,
		Text = title or "Luma UI",
		TextColor3 = Luma.Theme.PrimaryText,
		Font = Enum.Font.GothamBold,
		TextSize = 22,
		Position = UDim2.new(0, 20, 0, 14),
		Parent = titlebar,
	})
	self.Title = titleLabel
	
	-- Window controls
	local controlSize = 48
	local controlGap = 4
	
	local minimizeBtn = make("TextButton", {
		BackgroundTransparency = 1,
		Text = "−",
		TextColor3 = Luma.Theme.SecondaryText,
		Font = Enum.Font.GothamBold,
		TextSize = 24,
		Size = UDim2.new(0, controlSize, 1, 0),
		Position = UDim2.new(1, -(controlSize * 3 + controlGap * 2), 0, 0),
		Parent = titlebar,
	})
	
	local maximizeBtn = make("TextButton", {
		BackgroundTransparency = 1,
		Text = "□",
		TextColor3 = Luma.Theme.SecondaryText,
		Font = Enum.Font.GothamBold,
		TextSize = 18,
		Size = UDim2.new(0, controlSize, 1, 0),
		Position = UDim2.new(1, -(controlSize * 2 + controlGap), 0, 0),
		Parent = titlebar,
	})
	
	local closeBtn = make("TextButton", {
		BackgroundTransparency = 1,
		Text = "×",
		TextColor3 = Luma.Theme.SecondaryText,
		Font = Enum.Font.GothamBold,
		TextSize = 28,
		Size = UDim2.new(0, controlSize, 1, 0),
		Position = UDim2.new(1, -controlSize, 0, 0),
		Parent = titlebar,
	})
	
	addHoverEffects(minimizeBtn, Luma.Theme.SecondaryText)
	addHoverEffects(maximizeBtn, Luma.Theme.SecondaryText)
	addHoverEffects(closeBtn, Luma.Theme.SecondaryText)
	
	-- Dragging
	local dragging, dragStart, dragPos
	titlebar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			dragPos = main.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)
	
	titlebar.InputChanged:Connect(function(input)
		if dragging and dragStart and dragPos then
			local delta = input.Position - dragStart
			main.Position = UDim2.new(dragPos.X.Scale, dragPos.X.Offset + delta.X, dragPos.Y.Scale, dragPos.Y.Offset + delta.Y)
		end
	end)
	
	-- Minimize/Maximize
	local isMaximized = false
	local prevSize, prevPos
	
	minimizeBtn.MouseButton1Click:Connect(function()
		if not isMaximized then
			prevSize = main.Size
			prevPos = main.Position
			isMaximized = true
			tween(main, {Size = UDim2.new(0, 52, 0, 52)}, Luma.Anim.CloseTime)
			minimizeBtn.Text = "+"
		else
			isMaximized = false
			tween(main, {Size = prevSize or UDim2.new(0, 920, 0, 600), Position = prevPos or UDim2.new(0.5, 0, 0.5, 0)}, Luma.Anim.OpenTime, Enum.EasingStyle.Back)
			minimizeBtn.Text = "−"
		end
	end)
	
	maximizeBtn.MouseButton1Click:Connect(function()
		if not isMaximized then
			prevSize = main.Size
			prevPos = main.Position
			isMaximized = true
			tween(main, {Size = UDim2.new(1, -60, 1, -60), Position = UDim2.new(0, 30, 0, 30)}, Luma.Anim.OpenTime, Enum.EasingStyle.Back)
			maximizeBtn.Text = "❐"
		else
			isMaximized = false
			tween(main, {Size = prevSize or UDim2.new(0, 920, 0, 600), Position = prevPos or UDim2.new(0.5, 0, 0.5, 0)}, Luma.Anim.CloseTime)
			maximizeBtn.Text = "□"
		end
	end)
	
	closeBtn.MouseButton1Click:Connect(function()
		pcall(function()
			tween(main, {BackgroundTransparency = 1}, Luma.Anim.CloseTime)
			task.delay(Luma.Anim.CloseTime, function()
				screenGui:Destroy()
				self.ScreenGui = nil
			end)
		end)
	end)
	
	-- Double-click to maximize
	local lastClickTime = 0
	titlebar.MouseButton1Click:Connect(function()
		local now = tick()
		if now - lastClickTime < 0.35 then
			maximizeBtn:MouseButton1Click()
		end
		lastClickTime = now
	end)
	
	-- ================== BODY LAYOUT ==================
	local body = make("Frame", {
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 1, -52),
		Position = UDim2.new(0, 0, 0, 52),
		Parent = main,
	})
	
	-- Left sidebar for tabs
	local tabsPanel = make("Frame", {
		BackgroundColor3 = Luma.Theme.BackgroundLight,
		Size = UDim2.new(0, 240, 1, 0),
		Parent = body,
	})
	
	local tabsList = make("UIListLayout", {
		Parent = tabsPanel,
		FillDirection = Enum.FillDirection.Vertical,
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 4),
	})
	
	local tabsPadding = make("UIPadding", {Parent = tabsPanel})
	tabsPadding.PaddingLeft = UDim.new(0, 8)
	tabsPadding.PaddingRight = UDim.new(0, 8)
	tabsPadding.PaddingTop = UDim.new(0, 8)
	tabsPadding.PaddingBottom = UDim.new(0, 8)
	
	-- Right pane for content
	local contentPanel = make("Frame", {
		BackgroundColor3 = Luma.Theme.Background,
		Size = UDim2.new(1, -240, 1, 0),
		Position = UDim2.new(0, 240, 0, 0),
		Parent = body,
	})
	
	local contentScroll = make("ScrollingFrame", {
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 1, 0),
		Parent = contentPanel,
		ScrollBarThickness = 8,
		TopImage = "",
		BottomImage = "",
		MidImage = "",
	})
	contentScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
	
	local contentLayout = make("UIListLayout", {
		Parent = contentScroll,
		Padding = UDim.new(0, 12),
		FillDirection = Enum.FillDirection.Vertical,
	})
	
	local contentPadding = make("UIPadding", {Parent = contentScroll})
	contentPadding.PaddingLeft = UDim.new(0, 16)
	contentPadding.PaddingRight = UDim.new(0, 16)
	contentPadding.PaddingTop = UDim.new(0, 16)
	contentPadding.PaddingBottom = UDim.new(0, 16)
	
	self.TabsPanel = tabsPanel
	self.ContentPanel = contentPanel
	self.ContentScroll = contentScroll
	
	-- Entrance animation
	do
		main.BackgroundTransparency = 1
		main.Size = UDim2.new(0, 920 * 0.92, 0, 600 * 0.92)
		tween(main, {BackgroundTransparency = 0, Size = UDim2.new(0, 920, 0, 600)}, Luma.Anim.OpenTime, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
	end
	
	-- Mobile responsiveness
	if UserInputService.TouchEnabled then
		main.Size = UDim2.new(0, 700, 0, 500)
		tabsPanel.Size = UDim2.new(0, 200, 1, 0)
		contentPanel.Size = UDim2.new(1, -200, 1, 0)
		contentPanel.Position = UDim2.new(0, 200, 0, 0)
	end
	
	return self
end

-- ================== TAB SYSTEM ==================
function Luma:AddTab(title)
	local tabBtn = make("TextButton", {
		Text = title,
		BackgroundColor3 = Color3.fromRGB(35, 35, 42),
		TextColor3 = Luma.Theme.PrimaryText,
		Font = Enum.Font.Gotham,
		TextSize = 15,
		Size = UDim2.new(1, 0, 0, 40),
		Parent = self.TabsPanel,
		BorderSizePixel = 0,
	})
	make("UICorner", {Parent = tabBtn, CornerRadius = UDim.new(0, 6)})
	addHoverEffects(tabBtn)
	
	local tabContent = make("Frame", {
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 0),
		Parent = self.ContentScroll,
	})
	tabContent.AutomaticSize = Enum.AutomaticSize.Y
	
	local tabContentLayout = make("UIListLayout", {
		Parent = tabContent,
		Padding = UDim.new(0, 10),
		FillDirection = Enum.FillDirection.Vertical,
	})
	
	-- Tab switching
	tabBtn.MouseButton1Click:Connect(function()
		playSound("ButtonClick")
		for _, child in ipairs(self.ContentScroll:GetChildren()) do
			if child ~= tabContent and child:IsA("Frame") then
				tween(child, {BackgroundTransparency = 1}, Luma.Anim.DropdownReveal)
				task.delay(Luma.Anim.DropdownReveal, function()
					if child then child.Visible = false end
				end)
			end
		end
		tabContent.Visible = true
		tabContent.BackgroundTransparency = 1
		tween(tabContent, {BackgroundTransparency = 0}, Luma.Anim.DropdownReveal)
		
		-- Highlight active tab
		for _, btn in ipairs(self.TabsPanel:GetChildren()) do
			if btn:IsA("TextButton") then
				tween(btn, {BackgroundColor3 = Color3.fromRGB(35, 35, 42)}, Luma.Anim.HoverTime)
			end
		end
		tween(tabBtn, {BackgroundColor3 = Luma.Theme.Accent:Lerp(Luma.Theme.Background, 0.3)}, Luma.Anim.HoverTime)
	end)
	
	-- Hide by default, show first tab
	if #self.Tabs == 0 then
		tabContent.Visible = true
		tween(tabBtn, {BackgroundColor3 = Luma.Theme.Accent:Lerp(Luma.Theme.Background, 0.3)}, 0)
	else
		tabContent.Visible = false
	end
	
	local tab = {
		Title = title,
		Button = tabBtn,
		Content = tabContent,
		_callback = nil,
	}
	
	-- Section builder
	function tab:AddSection(name)
		local section = make("Frame", {
			BackgroundTransparency = 1,
			Size = UDim2.new(1, 0, 0, 0),
			Parent = tabContent,
		})
		section.AutomaticSize = Enum.AutomaticSize.Y
		
		local sectionLayout = make("UIListLayout", {Parent = section, Padding = UDim.new(0, 8)})
		
		-- Header
		local header = make("TextLabel", {
			BackgroundTransparency = 1,
			Text = name,
			TextColor3 = Luma.Theme.PrimaryText,
			Font = Enum.Font.GothamBold,
			TextSize = 15,
			TextXAlignment = Enum.TextXAlignment.Left,
			Size = UDim2.new(1, 0, 0, 24),
			Parent = section,
		})
		
		-- Items frame
		local items = make("Frame", {
			BackgroundTransparency = 1,
			Size = UDim2.new(1, 0, 0, 0),
			Parent = section,
		})
		items.AutomaticSize = Enum.AutomaticSize.Y
		
		local itemsLayout = make("UIListLayout", {Parent = items, Padding = UDim.new(0, 8)})
		
		-- ================== BUTTON ==================
		function items:AddButton(text, callback)
			local btn = make("TextButton", {
				Text = text,
				BackgroundColor3 = Color3.fromRGB(32, 32, 38),
				TextColor3 = Luma.Theme.PrimaryText,
				Font = Enum.Font.Gotham,
				TextSize = 14,
				Size = UDim2.new(1, 0, 0, 38),
				Parent = items,
				BorderSizePixel = 0,
				AutoButtonColor = false,
			})
			make("UICorner", {Parent = btn, CornerRadius = UDim.new(0, 6)})
			make("UIStroke", {Parent = btn, Color = Luma.Theme.Accent, Transparency = 0.85, Thickness = 1})
			
			addHoverEffects(btn)
			
			btn.MouseButton1Click:Connect(function()
				playSound("ButtonClick")
				
				-- Ripple effect
				local mousePos = UserInputService:GetMouseLocation()
				local relX = math.clamp(mousePos.X - btn.AbsolutePosition.X, 0, btn.AbsoluteSize.X)
				local relY = math.clamp(mousePos.Y - btn.AbsolutePosition.Y, 0, btn.AbsoluteSize.Y)
				createRipple(btn, UDim2.new(0, relX, 0, relY), Luma.Theme.Accent)
				
				-- Press animation
				tween(btn, {Size = UDim2.new(1, 0, 0, 36)}, Luma.Anim.ButtonPress, Enum.EasingStyle.Quad)
				task.delay(Luma.Anim.ButtonPress, function()
					if btn and btn.Parent then
						tween(btn, {Size = UDim2.new(1, 0, 0, 38)}, Luma.Anim.ButtonPress * 2, Enum.EasingStyle.Elastic)
					end
				end)
				
				if callback then pcall(callback) end
			end)
			
			return btn
		end
		
		-- ================== TOGGLE ==================
		function items:AddToggle(text, default, callback)
			default = default or false
			local wrap = make("Frame", {
				BackgroundTransparency = 1,
				Size = UDim2.new(1, 0, 0, 38),
				Parent = items,
			})
			
			local label = make("TextLabel", {
				BackgroundTransparency = 1,
				Text = text,
				TextColor3 = Luma.Theme.PrimaryText,
				Font = Enum.Font.Gotham,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Left,
				Position = UDim2.new(0, 0, 0, 8),
				Size = UDim2.new(1, -60, 0, 20),
				Parent = wrap,
			})
			
			local toggleBg = make("Frame", {
				BackgroundColor3 = Color3.fromRGB(50, 50, 60),
				Size = UDim2.new(0, 50, 0, 26),
				Position = UDim2.new(1, -54, 0, 6),
				Parent = wrap,
				BorderSizePixel = 0,
			})
			make("UICorner", {Parent = toggleBg, CornerRadius = UDim.new(1, 0)})
			
			local thumb = make("Frame", {
				BackgroundColor3 = default and Luma.Theme.Accent or Color3.fromRGB(180, 180, 190),
				Size = UDim2.new(0, 22, 0, 22),
				Position = UDim2.new(default and 1 or 0, default and -24 or 2, 0, 2),
				Parent = toggleBg,
				BorderSizePixel = 0,
			})
			make("UICorner", {Parent = thumb, CornerRadius = UDim.new(1, 0)})
			
			local isOn = default
			
			local function setState(value)
				isOn = value
				playSound("ToggleFlip")
				
				if isOn then
					tween(thumb, {Position = UDim2.new(1, -24, 0, 2)}, Luma.Anim.ToggleTime, Enum.EasingStyle.Quint)
					tween(thumb, {BackgroundColor3 = Luma.Theme.Accent}, Luma.Anim.ToggleTime)
					tween(toggleBg, {BackgroundColor3 = Color3.fromRGB(40, 50, 60)}, Luma.Anim.ToggleTime)
				else
					tween(thumb, {Position = UDim2.new(0, 2, 0, 2)}, Luma.Anim.ToggleTime, Enum.EasingStyle.Quint)
					tween(thumb, {BackgroundColor3 = Color3.fromRGB(180, 180, 190)}, Luma.Anim.ToggleTime)
					tween(toggleBg, {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}, Luma.Anim.ToggleTime)
				end
				
				if callback then pcall(callback, isOn) end
			end
			
			toggleBg.MouseButton1Click:Connect(function()
				setState(not isOn)
			end)
			
			return {Get = function() return isOn end, Set = setState}
		end
		
		-- ================== SLIDER ==================
		function items:AddSlider(text, min, max, default, callback)
			min, max, default = min or 0, max or 100, default or (min + max) / 2
			
			local wrap = make("Frame", {
				BackgroundTransparency = 1,
				Size = UDim2.new(1, 0, 0, 64),
				Parent = items,
			})
			
			local label = make("TextLabel", {
				BackgroundTransparency = 1,
				Text = text .. " — " .. string.format("%.2f", default),
				TextColor3 = Luma.Theme.PrimaryText,
				Font = Enum.Font.Gotham,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Left,
				Position = UDim2.new(0, 0, 0, 0),
				Size = UDim2.new(1, 0, 0, 20),
				Parent = wrap,
			})
			
			local sliderBg = make("Frame", {
				BackgroundColor3 = Color3.fromRGB(40, 40, 48),
				Size = UDim2.new(1, 0, 0, 14),
				Position = UDim2.new(0, 0, 0, 28),
				Parent = wrap,
				BorderSizePixel = 0,
			})
			make("UICorner", {Parent = sliderBg, CornerRadius = UDim.new(1, 0)})
			
			local fill = make("Frame", {
				BackgroundColor3 = Luma.Theme.Accent,
				Size = UDim2.new((default - min) / (max - min), 0, 1, 0),
				Parent = sliderBg,
				BorderSizePixel = 0,
			})
			make("UICorner", {Parent = fill, CornerRadius = UDim.new(1, 0)})
			
			local grab = make("TextButton", {
				BackgroundColor3 = Luma.Theme.Accent,
				Text = "",
				Size = UDim2.new(0, 20, 0, 20),
				Position = UDim2.new((default - min) / (max - min), -10, 0.5, -10),
				Parent = sliderBg,
				BorderSizePixel = 0,
				ZIndex = 10,
			})
			make("UICorner", {Parent = grab, CornerRadius = UDim.new(1, 0)})
			
			local function updateValue(x)
				local rel = math.clamp((x - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X, 0, 1)
				local value = min + (max - min) * rel
				label.Text = text .. " — " .. string.format("%.2f", value)
				tween(fill, {Size = UDim2.new(rel, 0, 1, 0)}, Luma.Anim.SliderTween, Enum.EasingStyle.Sine)
				tween(grab, {Position = UDim2.new(rel, -10, 0.5, -10)}, Luma.Anim.SliderTween, Enum.EasingStyle.Sine)
				if callback then pcall(callback, value) end
				return value
			end
			
			local dragging = false
			
			grab.MouseButton1Down:Connect(function()
				dragging = true
				playSound("SliderGrab")
				tween(grab, {Size = UDim2.new(0, 24, 0, 24)}, Luma.Anim.ButtonPress, Enum.EasingStyle.Quad)
			end)
			
			UserInputService.InputEnded:Connect(function(input)
				if dragging and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
					dragging = false
					tween(grab, {Size = UDim2.new(0, 20, 0, 20)}, Luma.Anim.ButtonPress * 1.5, Enum.EasingStyle.Elastic)
				end
			end)
			
			UserInputService.InputChanged:Connect(function(input)
				if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
					updateValue(input.Position.X)
				end
			end)
			
			return {Get = function() return tonumber(label.Text:match("— (.+)")) or default end}
		end
		
		-- ================== TEXTBOX ==================
		function items:AddTextbox(placeholder, callback)
			local box = make("TextBox", {
				Text = "",
				PlaceholderText = placeholder or "Enter text...",
				BackgroundColor3 = Color3.fromRGB(32, 32, 38),
				TextColor3 = Luma.Theme.PrimaryText,
				PlaceholderColor3 = Luma.Theme.SecondaryText,
				Font = Enum.Font.Gotham,
				TextSize = 14,
				Size = UDim2.new(1, 0, 0, 36),
				Parent = items,
				BorderSizePixel = 0,
				ClearTextOnFocus = false,
			})
			make("UICorner", {Parent = box, CornerRadius = UDim.new(0, 6)})
			make("UIStroke", {Parent = box, Color = Luma.Theme.Accent, Transparency = 0.85, Thickness = 1})
			
			box.FocusLost:Connect(function(enterPressed)
				if enterPressed and callback then
					pcall(callback, box.Text)
				end
			end)
			
			return box
		end
		
		-- ================== DROPDOWN ==================
		function items:AddDropdown(text, options, default, callback, opts)
			options = options or {}
			opts = opts or {}
			
			local wrap = make("Frame", {
				BackgroundTransparency = 1,
				Size = UDim2.new(1, 0, 0, 0),
				Parent = items,
			})
			wrap.AutomaticSize = Enum.AutomaticSize.Y
			
			local label = make("TextLabel", {
				BackgroundTransparency = 1,
				Text = text,
				TextColor3 = Luma.Theme.PrimaryText,
				Font = Enum.Font.Gotham,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Left,
				Position = UDim2.new(0, 0, 0, 0),
				Size = UDim2.new(1, 0, 0, 20),
				Parent = wrap,
			})
			
			local selected = {value = default or options[1]}
			
			local btn = make("TextButton", {
				Text = tostring(selected.value),
				BackgroundColor3 = Color3.fromRGB(32, 32, 38),
				TextColor3 = Luma.Theme.PrimaryText,
				Font = Enum.Font.Gotham,
				TextSize = 14,
				Size = UDim2.new(1, 0, 0, 36),
				Position = UDim2.new(0, 0, 0, 24),
				Parent = wrap,
				BorderSizePixel = 0,
				AutoButtonColor = false,
			})
			make("UICorner", {Parent = btn, CornerRadius = UDim.new(0, 6)})
			make("UIStroke", {Parent = btn, Color = Luma.Theme.Accent, Transparency = 0.85, Thickness = 1})
			
			local listFrame = make("Frame", {
				BackgroundColor3 = Color3.fromRGB(28, 28, 34),
				Size = UDim2.new(1, 0, 0, 0),
				Position = UDim2.new(0, 0, 0, 64),
				Parent = wrap,
				ClipsDescendants = true,
				Visible = false,
				BorderSizePixel = 0,
				ZIndex = 100,
			})
			make("UICorner", {Parent = listFrame, CornerRadius = UDim.new(0, 6)})
			
			local listLayout = make("UIListLayout", {Parent = listFrame, Padding = UDim.new(0, 2)})
			
			local listPadding = make("UIPadding", {Parent = listFrame})
			listPadding.PaddingLeft = UDim.new(0, 4)
			listPadding.PaddingRight = UDim.new(0, 4)
			listPadding.PaddingTop = UDim.new(0, 4)
			listPadding.PaddingBottom = UDim.new(0, 4)
			
			local function buildList()
				for _, child in ipairs(listFrame:GetChildren()) do
					if child ~= listLayout and child ~= listPadding then
						child:Destroy()
					end
				end
				
				local entries = 0
				for _, opt in ipairs(options) do
					entries = entries + 1
					local optBtn = make("TextButton", {
						Text = tostring(opt),
						BackgroundColor3 = selected.value == opt and Luma.Theme.Accent or Color3.fromRGB(40, 40, 48),
						TextColor3 = Luma.Theme.PrimaryText,
						Font = Enum.Font.Gotham,
						TextSize = 13,
						Size = UDim2.new(1, 0, 0, 30),
						Parent = listFrame,
						BorderSizePixel = 0,
						AutoButtonColor = false,
					})
					make("UICorner", {Parent = optBtn, CornerRadius = UDim.new(0, 4)})
					
					optBtn.MouseButton1Click:Connect(function()
						selected.value = opt
						btn.Text = tostring(opt)
						buildList()
						tween(listFrame, {Size = UDim2.new(1, 0, 0, 0)}, Luma.Anim.DropdownReveal)
						task.delay(Luma.Anim.DropdownReveal, function()
							if listFrame then listFrame.Visible = false end
						end)
						if callback then pcall(callback, opt) end
					end)
					
					-- Stagger animation
					optBtn.BackgroundTransparency = 1
					optBtn.TextTransparency = 1
					task.delay(Luma.Anim.EntryStagger * (entries - 1), function()
						if optBtn and optBtn.Parent then
							tween(optBtn, {BackgroundTransparency = 0, TextTransparency = 0}, 0.18, Enum.EasingStyle.Quad)
						end
					end)
				end
				
				listFrame.Size = UDim2.new(1, 0, 0, math.min(entries * 32 + 8, 300))
			end
			
			btn.MouseButton1Click:Connect(function()
				if listFrame.Visible then
					tween(listFrame, {Size = UDim2.new(1, 0, 0, 0)}, Luma.Anim.DropdownReveal)
					task.delay(Luma.Anim.DropdownReveal, function()
						if listFrame then listFrame.Visible = false end
					end)
				else
					playSound("DropdownOpen")
					listFrame.Visible = true
					buildList()
					tween(listFrame, {Size = listFrame.Size}, Luma.Anim.DropdownReveal)
				end
			end)
			
			return {Get = function() return selected.value end, Set = function(v) selected.value = v; btn.Text = tostring(v); buildList() end}
		end
		
		-- ================== KEYBIND ==================
		function items:AddKeybind(text, defaultKey, callback)
			local key = defaultKey or "None"
			
			local wrap = make("Frame", {
				BackgroundTransparency = 1,
				Size = UDim2.new(1, 0, 0, 38),
				Parent = items,
			})
			
			local label = make("TextLabel", {
				BackgroundTransparency = 1,
				Text = text,
				TextColor3 = Luma.Theme.PrimaryText,
				Font = Enum.Font.Gotham,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Left,
				Position = UDim2.new(0, 0, 0, 8),
				Size = UDim2.new(1, -140, 0, 20),
				Parent = wrap,
			})
			
			local keyBtn = make("TextButton", {
				Text = tostring(key),
				BackgroundColor3 = Color3.fromRGB(32, 32, 38),
				TextColor3 = Luma.Theme.Accent,
				Font = Enum.Font.GothamBold,
				TextSize = 13,
				Size = UDim2.new(0, 130, 0, 24),
				Position = UDim2.new(1, -134, 0, 7),
				Parent = wrap,
				BorderSizePixel = 0,
				AutoButtonColor = false,
			})
			make("UICorner", {Parent = keyBtn, CornerRadius = UDim.new(0, 6)})
			
			local listening = false
			local conn
			
			keyBtn.MouseButton1Click:Connect(function()
				if listening then return end
				listening = true
				keyBtn.Text = "Listening..."
				keyBtn.TextColor3 = Color3.fromRGB(255, 152, 0)
				
				conn = UserInputService.InputBegan:Connect(function(input, gameProcessed)
					if gameProcessed then return end
					if input.KeyCode then
						key = tostring(input.KeyCode):gsub("Enum.KeyCode.", "")
						keyBtn.Text = key
						keyBtn.TextColor3 = Luma.Theme.Accent
						listening = false
						if conn then conn:Disconnect() end
						if callback then pcall(callback, key) end
					end
				end)
			end)
			
			return {Get = function() return key end}
		end
		
		-- ================== COLOR PICKER ==================
		function items:AddColorPicker(text, defaultColor, callback)
			defaultColor = defaultColor or Color3.fromRGB(120, 80, 255)
			
			local wrap = make("Frame", {
				BackgroundTransparency = 1,
				Size = UDim2.new(1, 0, 0, 0),
				Parent = items,
			})
			wrap.AutomaticSize = Enum.AutomaticSize.Y
			
			local label = make("TextLabel", {
				BackgroundTransparency = 1,
				Text = text,
				TextColor3 = Luma.Theme.PrimaryText,
				Font = Enum.Font.Gotham,
				TextSize = 14,
				Position = UDim2.new(0, 0, 0, 0),
				Size = UDim2.new(1, 0, 0, 20),
				Parent = wrap,
			})
			
			local preview = make("Frame", {
				BackgroundColor3 = defaultColor,
				Size = UDim2.new(1, 0, 0, 50),
				Position = UDim2.new(0, 0, 0, 24),
				Parent = wrap,
				BorderSizePixel = 0,
			})
			make("UICorner", {Parent = preview, CornerRadius = UDim.new(0, 6)})
			make("UIStroke", {Parent = preview, Color = Luma.Theme.Accent, Thickness = 2})
			
			return {Get = function() return preview.BackgroundColor3 end}
		end
		
		return items
	end
	
	table.insert(self.Tabs, tab)
	return tab
end

-- ================== NOTIFICATIONS ==================
function Luma:Notify(title, text, duration)
	playSound("NotifyShow")
	self._notifyQueue = self._notifyQueue or {}
	table.insert(self._notifyQueue, {title = title, text = text, time = duration or 4})
	
	if self._notifyRunning then return end
	self._notifyRunning = true
	
	while #self._notifyQueue > 0 do
		local item = table.remove(self._notifyQueue, 1)
		
		local notif = make("Frame", {
			Size = UDim2.new(0, 320, 0, 80),
			BackgroundColor3 = Color3.fromRGB(28, 28, 34),
			AnchorPoint = Vector2.new(1, 0),
			Position = UDim2.new(1, 20, 0, 20),
			Parent = self.ScreenGui,
			ZIndex = 500,
			BorderSizePixel = 0,
		})
		make("UICorner", {Parent = notif, CornerRadius = UDim.new(0, 8)})
		make("UIStroke", {Parent = notif, Color = Luma.Theme.Accent, Thickness = 2})
		
		local titleLbl = make("TextLabel", {
			Text = item.title,
			BackgroundTransparency = 1,
			TextColor3 = Luma.Theme.PrimaryText,
			Font = Enum.Font.GothamBold,
			TextSize = 16,
			Position = UDim2.new(0, 12, 0, 8),
			Size = UDim2.new(1, -24, 0, 24),
			Parent = notif,
		})
		
		local textLbl = make("TextLabel", {
			Text = text,
			BackgroundTransparency = 1,
			TextColor3 = Luma.Theme.SecondaryText,
			Font = Enum.Font.Gotham,
			TextSize = 13,
			Position = UDim2.new(0, 12, 0, 36),
			Size = UDim2.new(1, -24, 0, 36),
			TextWrapped = true,
			Parent = notif,
		})
		
		-- Slide in
		notif.Position = UDim2.new(1, 340, 0, 20)
		notif.BackgroundTransparency = 1
		tween(notif, {Position = UDim2.new(1, -20, 0, 20), BackgroundTransparency = 0}, 0.36, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
		
		-- Text fade
		titleLbl.TextTransparency = 1
		textLbl.TextTransparency = 1
		tween(titleLbl, {TextTransparency = 0}, 0.36)
		tween(textLbl, {TextTransparency = 0}, 0.36)
		
		-- Wait duration
		task.wait(item.time)
		
		-- Slide out
		tween(notif, {Position = UDim2.new(1, 340, 0, 20), BackgroundTransparency = 1}, 0.28, Enum.EasingStyle.Sine, Enum.EasingDirection.In)
		task.delay(0.28, function()
			if notif and notif.Parent then notif:Destroy() end
		end)
		
		task.wait(0.4)
	end
	
	self._notifyRunning = false
end

-- ================== THEMING ==================
function Luma:SetTheme(theme)
	for k, v in pairs(theme) do
		Luma.Theme[k] = v
	end
end

-- ================== SETTINGS ==================
function Luma:SetSetting(key, value)
	self.Settings = self.Settings or {}
	self.Settings[key] = value
end

function Luma:GetSetting(key, default)
	self.Settings = self.Settings or {}
	return self.Settings[key] or default
end

function Luma:ExportSettings()
	return HttpService:JSONEncode(self.Settings or {})
end

function Luma:ImportSettings(json)
	local ok, result = pcall(function() return HttpService:JSONDecode(json) end)
	if ok and type(result) == "table" then
		self.Settings = result
		return true
	end
	return false
end

function Luma:SaveToFile(filename)
	if not writefile then return false end
	local json = self:ExportSettings()
	if json then
		writefile(filename, json)
		return true
	end
	return false
end

function Luma:LoadFromFile(filename)
	if not readfile or not isfile(filename) then return false end
	local content = readfile(filename)
	return self:ImportSettings(content)
end

return Luma
